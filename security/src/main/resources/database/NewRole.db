-- Drop the tables if they exist
DROP TABLE IF EXISTS "token";
DROP TABLE IF EXISTS "app_user";

-- Create the "app_user" table with a role column
CREATE TABLE "app_user" (
    "id" UUID PRIMARY KEY,
    "email" VARCHAR(255) NOT NULL,
    "password" VARCHAR(255) NOT NULL,
    "role" VARCHAR(255) CHECK ("role" IN ('USER','ADMIN','MANAGER')), -- Role column
    "shop_id" UUID NOT NULL
);

-- Insert sample data into the "app_user" table with manual UUIDs for shop_id
INSERT INTO "app_user" ("id", "email", "password", "role", "shop_id")
VALUES
    ('f47ac10b-58cc-4372-a567-0e02b2c3d479', 'ole.nordmann@example.com', 'password123', 'ADMIN', '123e4567-e89b-12d3-a456-426614174000'),
    ('c8c7f4a2-8c2b-4c4f-a3e5-8d47d960c8e3', 'kari.nordkvinne@example.com', 'securePass', 'USER', '123e4567-e89b-12d3-a456-426614174001'),
    ('1a75e52b-0c25-4b2e-8e0a-29d088af3b67', 'lars.berg@example.com', 'mySecret', 'MANAGER', '123e4567-e89b-12d3-a456-426614174002');

-- Create the "token" table
CREATE TABLE "token" (
    "id" UUID PRIMARY KEY,
    "token" VARCHAR(1024) UNIQUE NOT NULL,
    "token_type" VARCHAR(255) NOT NULL,
    "revoked" BOOLEAN NOT NULL,
    "expired" BOOLEAN NOT NULL,
    "user_id" UUID REFERENCES "app_user"("id") ON DELETE CASCADE
);
